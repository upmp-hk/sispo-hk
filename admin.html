<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SISPO HK - Admin</title>
  <link rel="stylesheet" href="sispo.css" />
  <style>
    :root {
      --blue: #1d4ed8;
      --blue-soft: #bfdbfe;
      --blue-soft2: #dbeafe;
      --green: #10b981;
      --green-soft: #bbf7d0;
      --green-soft2: #dcfce7;
      --white: #ffffff;
      --text: #000000;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #dbeafe, #dcfce7);
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 12px;
      color: var(--text);
    }
    .app-shell {
      width: 100%;
      max-width: 1280px;
      min-height: 620px;
      background: var(--white);
      border-radius: 18px;
      overflow: hidden;
      display: flex;
      box-shadow: 0 16px 40px rgba(0,0,0,0.2);
    }
    /* MAIN */
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: var(--white);
    }
    .main-header {
      padding: 12px 18px;
      border-bottom: 2px solid var(--blue-soft2);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .main-header-left {
      display: flex;
      flex-direction: column;
    }
    .main-title {
      font-size: 17px;
      font-weight: 700;
    }
    .main-subtitle {
      font-size: 11px;
      opacity: 0.75;
    }
    .main-header-right {
      font-size: 11px;
      text-align: right;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 8px;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid var(--green);
      background: var(--green);
      color: var(--white);
      font-size: 11.5px;
    }
    .main-body {
      flex: 1;
      padding: 14px 18px 16px;
      background: linear-gradient(135deg, #ffffff, #eff6ff);
      overflow-y: auto;
    }
    .btn {
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid var(--blue);
      background: var(--blue);
      color: var(--white);
      font-size: 11.5px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    .btn.secondary {
      border-color: var(--green);
      background: var(--green);
    }
    .btn:hover {
      opacity: 0.92;
    }


    /* LOGIN ADMIN */
    .login-page {
      max-width: 420px;
      margin: 32px auto;
      background: var(--white);
      border-radius: 16px;
      border: 1px solid var(--blue-soft2);
      box-shadow: 0 12px 30px rgba(0,0,0,0.15);
      padding: 20px 18px 18px;
    }
    .login-header {
      text-align: center;
      margin-bottom: 16px;
    }
    .login-badge {
      display: inline-flex;
      padding: 3px 10px;
      border-radius: 999px;
      background: var(--green-soft);
      font-size: 11px;
      margin-bottom: 6px;
    }
    .login-title {
      font-size: 19px;
      font-weight: 700;
    }
    .login-subtitle {
      font-size: 12px;
      opacity: 0.75;
    }
    .login-form-group {
      text-align: left;
      margin-bottom: 12px;
      font-size: 13px;
    }
    .login-form-group label {
      display: block;
      margin-bottom: 4px;
      font-weight: 600;
    }
    .login-form-group input {
      width: 100%;
      padding: 9px 11px;
      border-radius: 10px;
      border: 1px solid var(--blue-soft2);
      font-size: 13px;
      outline: none;
    }
    .login-form-group input:focus {
      border-color: var(--blue);
      box-shadow: 0 0 0 1px rgba(37,99,235,0.35);
    }
    .password-wrapper {
      position: relative;
    }
    .password-wrapper input {
      padding-right: 70px;
    }
    .toggle-password {
      position: absolute;
      right: 9px;
      top: 50%;
      transform: translateY(-50%);
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 11px;
      padding: 2px 4px;
    }
    .login-button {
      width: 100%;
      margin-top: 8px;
      padding: 10px 10px;
      border-radius: 999px;
      border: 1px solid var(--green);
      background: var(--green);
      color: var(--white);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }
    .login-button:hover {
      background: #059669;
      border-color: #059669;
    }
    .login-error {
      margin-top: 8px;
      font-size: 12px;
      color: #b91c1c;
      min-height: 16px;
    }
    .login-footer {
      margin-top: 10px;
      font-size: 11px;
      text-align: center;
      opacity: 0.8;
    }

    /* ADMIN MODE */
    .admin-wrapper {
      max-width: 980px;
      margin: 0 auto;
      display: none;
      flex-direction: column;
      gap: 16px;
    }
    .admin-card {
      background: var(--white);
      border-radius: 16px;
      padding: 14px 16px;
      box-shadow: 0 8px 22px rgba(0,0,0,0.08);
      border: 1px solid var(--blue-soft2);
      font-size: 12px;
    }
    .admin-card-title {
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    /* Tombol template: selaras dengan .btn */
    .template-btn {
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid var(--blue);
      background: var(--blue);
      color: var(--white);
      font-size: 11.5px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    .template-btn.secondary {
      border-color: var(--green);
      background: var(--green);
    }
    .template-btn:hover {
      opacity: 0.92;
    }
    .template-btn input[type="file"] {
      display: none;
    }

    /* TABEL INPUT DATA SANTRI (ADMIN) */
    .admin-table-card {
      background: var(--white);
      border-radius: 14px;
      padding: 10px 11px 9px;
      border: 1px solid var(--blue-soft2);
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
      margin-top: 4px;
      font-size: 11.5px;
    }
    .admin-table-title {
      font-size: 13.5px;
      font-weight: 700;
      margin-bottom: 7px;
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      flex-wrap: wrap;
    }
    .admin-table-title small {
      font-size: 11px;
      opacity: 0.8;
    }
    .admin-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11.5px;
    }
    .admin-table th,
    .admin-table td {
      border: 1px solid var(--blue-soft2);
      padding: 4px 5px;
      text-align: center;
    }
    .admin-table th {
      background: var(--blue-soft2);
      font-weight: 600;
    }
    .admin-table td.align-left {
      text-align: left;
    }
    .admin-table input[type="text"],
    .admin-table input[type="date"],
    .admin-table input[type="tel"],
    .admin-table input[type="file"],
    .admin-table select {
      width: 100%;
      box-sizing: border-box;
      padding: 2px 4px;
      border-radius: 6px;
      border: 1px solid var(--blue-soft2);
      font-size: 11px;
      outline: none;
      text-align: left;
    }
    .admin-table select {
      padding-right: 18px;
    }
    .admin-table input:focus,
    .admin-table select:focus {
      border-color: var(--green);
      box-shadow: 0 0 0 1px rgba(16,185,129,0.35);
    }
    /* Tombol upload foto di tabel (warna hijau seperti Upload Data) */
    .admin-photo-upload {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid var(--green);
      background: var(--green);
      color: var(--white);
      font-size: 10.5px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }
    .admin-photo-upload:hover {
      opacity: 0.92;
    }
    .admin-photo-upload input[type="file"] {
      display: none;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo-box">
          <img src="https://uploads.onecompiler.io/444e96suz/444e96fm2/cropped-00_Logo-HK-Utama.webp" alt="Logo HK">
        </div>
        <div class="sidebar-title">
          <strong>SISPO HK</strong>
          <span>Sistem Informasi Santri</span>
        </div>
      </div>

      <div class="sidebar-nav">
        <div class="nav-section-title">Mode Akses</div>

        <div class="nav-item">
          <a href="index.html">
            <span>Santri &amp; Wali Santri</span>
            <span class="nav-tag">Rapot</span>
          </a>
        </div>

        <div class="nav-item">
          <a href="guru.html">
            <span>Guru</span>
            <span class="nav-tag">Akademik</span>
          </a>
        </div>

        <div class="nav-item">
          <a href="musyrif.html">
            <span>Musyrif</span>
            <span class="nav-tag">TTQ</span>
          </a>
        </div>

        <div class="nav-item">
          <a href="murobbi.html">
            <span>Murobbi</span>
            <span class="nav-tag">Mutabaah</span>
          </a>
        </div>

        <div class="nav-item">
          <a href="bahasa.html">
            <span>Bahasa</span>
            <span class="nav-tag">Arab &amp; Inggris</span>
          </a>
        </div>

        <div class="nav-item">
          <a href="pengasuhan.html">
            <span>Pengasuhan</span>
            <span class="nav-tag">Poin Pelanggaran</span>
          </a>
        </div>

        <div class="nav-item active">
          <span>Admin</span>
          <span class="nav-tag">Data Profil</span>
        </div>
      </div>

      <div class="sidebar-footer">
        Pontren Husnul Khotimah
        <span>Dashboard Rapot Terintegrasi</span>
      </div>
    </aside>

    <!-- MAIN -->
    <div class="main">
      <header class="main-header">
        <div class="main-header-left">
          <div class="main-title">Sistem Informasi Santri Pontren Husnul Khotimah</div>
          <div class="main-subtitle">
            Form input Data Profil Santri oleh Admin.
          </div>
        </div>
        <div class="main-header-right">
          Mode: <span>Admin</span>
          <span class="badge" id="statusBadgeAdmin">Login diperlukan</span>
          <button type="button"
                  id="logoutAdminBtn"
                  class="btn"
                  onclick="handleLogoutAdmin()"
                  style="display:none;">
            Logout
          </button>
        </div>
      </header>

      <main class="main-body">
        <!-- LOGIN ADMIN -->
        <div id="loginAdminContainer" class="login-page">
          <div class="login-header">
            <div class="login-badge">ðŸ”‘ Login</div>
            <div class="login-title">Admin</div>
            <div class="login-subtitle">
              Gunakan akun Admin untuk mengisi Data Profil Santri
            </div>
          </div>

          <form id="loginAdminForm" onsubmit="handleLoginAdmin(event)">
            <div class="login-form-group">
              <label for="loginAdminID">Username</label>
              <input type="text" id="loginAdminID" placeholder="admin" autocomplete="username" />
            </div>
            <div class="login-form-group">
              <label for="loginAdminPassword">Password</label>
              <div class="password-wrapper">
                <input type="password" id="loginAdminPassword" placeholder="admin" autocomplete="current-password" />
                <button
                  type="button"
                  class="toggle-password"
                  data-target="loginAdminPassword"
                  onclick="togglePassword(this)">
                  Show
                </button>
              </div>
            </div>
            <button class="login-button" type="submit">Masuk</button>
          </form>

          <div id="loginAdminError" class="login-error"></div>

          <div class="login-footer">
            Contoh akun: Username <b>admin</b>, Password <b>admin</b>.
          </div>
        </div>

        <!-- ADMIN MODE -->
        <div id="adminWrapper" class="admin-wrapper">
          <!-- Kartu template (Download/Upload) -->
          <div class="admin-card">
            <div class="admin-card-title">Master Data Profil Santri</div>
            <p style="margin-bottom:8px;">
              Download template, isi di Excel, lalu upload kembali untuk pembaruan master data santri (simulasi).
            </p>
            <button class="template-btn" type="button" onclick="downloadTemplateAdmin()">
              â¬‡ Download Template (.xls)
            </button>
            <label class="template-btn secondary">
              â¬† Upload Data (.xls / .xlsx)
              <input type="file" id="adminUpload" accept=".xls,.xlsx" onchange="uploadTemplateAdmin(event)" />
            </label>
          </div>

          <!-- Kartu tabel input manual -->
          <div class="admin-table-card">
            <div class="admin-table-title">
              <span>Input Data Profil Santri</span>
              <small>Isikan beberapa baris sebagai contoh pengisian (simulasi, belum tersimpan ke database).</small>
            </div>

            <table class="admin-table">
              <thead>
                <tr>
                  <th>No.</th>
                  <th>Foto</th>
                  <th>Nama Lengkap</th>
                  <th>NIS</th>
                  <th>NISN</th>
                  <th style="width:95px;">Jenis Kelamin</th>
                  <th>Tempat Lahir</th>
                  <th>Tanggal Lahir</th>
                  <th>Alamat</th>
                  <th>Nama Ayah</th>
                  <th>No. Telp. Ayah</th>
                  <th>Nama Ibu</th>
                  <th>No. Telp. Ibu</th>
                </tr>
              </thead>
              <tbody>
                <!-- Baris 1 -->
                <tr>
                  <td>1</td>
                  <td>
                    <label class="admin-photo-upload">
                      Upload
                      <input type="file" accept="image/*" />
                    </label>
                  </td>
                  <td><input type="text" placeholder="Nama lengkap santri" /></td>
                  <td><input type="text" placeholder="2023.001234" /></td>
                  <td><input type="text" placeholder="1234567890" /></td>
                  <td>
                    <select>
                      <option value="Ikhwan">Ikhwan</option>
                      <option value="Akhwat">Akhwat</option>
                    </select>
                  </td>
                  <td><input type="text" placeholder="Kuningan" /></td>
                  <td><input type="date" /></td>
                  <td><input type="text" placeholder="Alamat lengkap" /></td>
                  <td><input type="text" placeholder="Nama ayah" /></td>
                  <td><input type="tel" placeholder="No. HP Ayah" /></td>
                  <td><input type="text" placeholder="Nama ibu" /></td>
                  <td><input type="tel" placeholder="No. HP Ibu" /></td>
                </tr>

                <!-- Baris 2 -->
                <tr>
                  <td>2</td>
                  <td>
                    <label class="admin-photo-upload">
                      Upload
                      <input type="file" accept="image/*" />
                    </label>
                  </td>
                  <td><input type="text" /></td>
                  <td><input type="text" /></td>
                  <td><input type="text" /></td>
                  <td>
                    <select>
                      <option value="Ikhwan">Ikhwan</option>
                      <option value="Akhwat">Akhwat</option>
                    </select>
                  </td>
                  <td><input type="text" /></td>
                  <td><input type="date" /></td>
                  <td><input type="text" /></td>
                  <td><input type="text" /></td>
                  <td><input type="tel" /></td>
                  <td><input type="text" /></td>
                  <td><input type="tel" /></td>
                </tr>

                <!-- Baris 3 -->
                <tr>
                  <td>3</td>
                  <td>
                    <label class="admin-photo-upload">
                      Upload
                      <input type="file" accept="image/*" />
                    </label>
                  </td>
                  <td><input type="text" /></td>
                  <td><input type="text" /></td>
                  <td><input type="text" /></td>
                  <td>
                    <select>
                      <option value="Ikhwan">Ikhwan</option>
                      <option value="Akhwat">Akhwat</option>
                    </select>
                  </td>
                  <td><input type="text" /></td>
                  <td><input type="date" /></td>
                  <td><input type="text" /></td>
                  <td><input type="text" /></td>
                  <td><input type="tel" /></td>
                  <td><input type="text" /></td>
                  <td><input type="tel" /></td>
                </tr>

                <!-- Baris 4 -->
                <tr>
                  <td>4</td>
                  <td>
                    <label class="admin-photo-upload">
                      Upload
                      <input type="file" accept="image/*" />
                    </label>
                  </td>
                  <td><input type="text" /></td>
                  <td><input type="text" /></td>
                  <td><input type="text" /></td>
                  <td>
                    <select>
                      <option value="Ikhwan">Ikhwan</option>
                      <option value="Akhwat">Akhwat</option>
                    </select>
                  </td>
                  <td><input type="text" /></td>
                  <td><input type="date" /></td>
                  <td><input type="text" /></td>
                  <td><input type="text" /></td>
                  <td><input type="tel" /></td>
                  <td><input type="text" /></td>
                  <td><input type="tel" /></td>
                </tr>

                <!-- Baris 5 -->
                <tr>
                  <td>5</td>
                  <td>
                    <label class="admin-photo-upload">
                      Upload
                      <input type="file" accept="image/*" />
                    </label>
                  </td>
                  <td><input type="text" /></td>
                  <td><input type="text" /></td>
                  <td><input type="text" /></td>
                  <td>
                    <select>
                      <option value="Ikhwan">Ikhwan</option>
                      <option value="Akhwat">Akhwat</option>
                    </select>
                  </td>
                  <td><input type="text" /></td>
                  <td><input type="date" /></td>
                  <td><input type="text" /></td>
                  <td><input type="text" /></td>
                  <td><input type="tel" /></td>
                  <td><input type="text" /></td>
                  <td><input type="tel" /></td>
                </tr>
              </tbody>
            </table>

            <p style="margin-top:6px; font-size:10.5px; opacity:0.8;">
              *Saat ini tabel hanya simulasi input. Penyimpanan ke database akan diatur di sisi backend/server.
            </p>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script>
    // LOGIN ADMIN (testing): admin / admin
    const ADMIN_USER = "admin";
    const ADMIN_PASS = "admin";
    const ADMIN_SESSION_KEY = "sispo_admin_session";
    const SESSION_DURATION_MS = 5 * 60 * 1000;
    let adminLogoutTimer = null;

    function handleLoginAdmin(event) {
      event.preventDefault();
      const user = document.getElementById("loginAdminID").value.trim();
      const pass = document.getElementById("loginAdminPassword").value.trim();
      const errorEl = document.getElementById("loginAdminError");
    
      if (!user || !pass) {
        errorEl.textContent = "Username dan password wajib diisi.";
        return;
      }
    
      if (user === ADMIN_USER && pass === ADMIN_PASS) {
        errorEl.textContent = "";
        setAdminSession();
        applyAdminLoginUI();
        scheduleAdminAutoLogout();
      } else {
        errorEl.textContent = "Username atau password tidak sesuai.";
      }
    }

    function applyAdminLoginUI() {
      document.getElementById("loginAdminContainer").style.display = "none";
      document.getElementById("adminWrapper").style.display = "flex";
      document.getElementById("statusBadgeAdmin").textContent = "Login";
      const btn = document.getElementById("logoutAdminBtn");
      if (btn) btn.style.display = "inline-block";
    }
    
    function applyAdminLogoutUI() {
      document.getElementById("loginAdminContainer").style.display = "block";
      document.getElementById("adminWrapper").style.display = "none";
      document.getElementById("statusBadgeAdmin").textContent = "Login diperlukan";
      const btn = document.getElementById("logoutAdminBtn");
      if (btn) btn.style.display = "none";
    }
    
    function setAdminSession() {
      const expiresAt = Date.now() + SESSION_DURATION_MS;
      localStorage.setItem(ADMIN_SESSION_KEY, JSON.stringify({ expiresAt }));
    }
    
    function clearAdminSession() {
      localStorage.removeItem(ADMIN_SESSION_KEY);
      if (adminLogoutTimer) {
        clearTimeout(adminLogoutTimer);
        adminLogoutTimer = null;
      }
    }
    
    function scheduleAdminAutoLogout() {
      const raw = localStorage.getItem(ADMIN_SESSION_KEY);
      if (!raw) return;
    
      try {
        const { expiresAt } = JSON.parse(raw);
        const remaining = expiresAt - Date.now();
        if (remaining <= 0) {
          handleLogoutAdmin();
        } else {
          if (adminLogoutTimer) clearTimeout(adminLogoutTimer);
          adminLogoutTimer = setTimeout(handleLogoutAdmin, remaining);
        }
      } catch (e) {
        handleLogoutAdmin();
      }
    }
    
    function handleLogoutAdmin() {
      clearAdminSession();
      applyAdminLogoutUI();
    
      const form = document.getElementById("loginAdminForm");
      if (form) form.reset();
      const errorEl = document.getElementById("loginAdminError");
      if (errorEl) errorEl.textContent = "";
    }
    
    document.addEventListener("DOMContentLoaded", function () {
      const raw = localStorage.getItem(ADMIN_SESSION_KEY);
      if (!raw) return;
    
      try {
        const { expiresAt } = JSON.parse(raw);
        if (expiresAt && expiresAt > Date.now()) {
          applyAdminLoginUI();
          scheduleAdminAutoLogout();
        } else {
          clearAdminSession();
          applyAdminLogoutUI();
        }
      } catch (e) {
        clearAdminSession();
        applyAdminLogoutUI();
      }
    });

    function togglePassword(btn) {
      const targetId = btn.getAttribute("data-target");
      const input = document.getElementById(targetId);
      if (!input) return;

      if (input.type === "password") {
        input.type = "text";
        btn.textContent = "Hide";
      } else {
        input.type = "password";
        btn.textContent = "Show";
      }
    }

    // DOWNLOAD TEMPLATE MASTER DATA (.xls, isi format CSV)
    function downloadTemplateAdmin() {
      let csv = "";
      csv += "NIS,Nama Santri,Jenis Kelamin,Jenjang,Kelas,Paralel/Asrama\r\n";
      csv += "2023.001234,Ahmad Husnul Karim,Ikhwan,MA,XI,Utsman Bin Affan\r\n";

      const blob = new Blob([csv], { type: "application/vnd.ms-excel" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "template_master_data_santri.xls";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // UPLOAD TEMPLATE (simulasi)
    function uploadTemplateAdmin(event) {
      const file = event.target.files[0];
      if (!file) return;

      const ext = file.name.toLowerCase().split(".").pop();
      if (ext !== "xls" && ext !== "xlsx") {
        alert("Gunakan file .xls atau .xlsx.");
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        console.log("File master data admin ter-upload (simulasi), size:", e.target.result.byteLength, "bytes");
        alert("File master data ter-upload (simulasi). Parsing detail butuh library tambahan di backend.");
      };
      reader.readAsArrayBuffer(file);
    }
  </script>
</body>
</html>
